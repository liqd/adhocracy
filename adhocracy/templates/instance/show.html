<%inherit file="/template.html" />
<%namespace name="components" file="/components.html"/>
<%namespace name="map" file="/geo/map.html"/>
<%def name="title()">${_("Home")}</%def>

<%def name="breadcrumbs()">
    ${h.instance.breadcrumbs(c.page_instance)|n} ${_("Home")}
</%def>


<%block name="main_content">

  ${c.tile.description|n}

  <div id="new_proposals_table" class="table">
      <h3 class="section">${_("Newest Proposals")}</h3>
      ${c.new_proposals_pager.here()}

  <div id="proposal-actions">
  <% auth = check.proposal.create() %>
  %if auth:
      <a class="button add ttip" title="${_('Introduce a new idea to debate.')}" href="/proposal/new">${_("new proposal")}</a>
  %elif auth.propose_join():
      <a class="button add ttip" title="${_('Join instance to create a new proposal.')}" href="/proposal/new" rel="#overlay-join-button">${_("new proposal")}</a>
  %elif auth.propose_login():
      <a class="button add ttip" title="${_('Login to create a new proposal.')}" href="/proposal/new" rel="#overlay-login-button">${_("new proposal")}</a>
  %endif

  <a href="/proposal" class="button edit ttip" title="${_('show a list of proposals')}">${_("more proposals")}</a>
  </div>

  </div>
  <br/>

<div class="clearFix" id="numbers"></div>
    <h3>${_("By the numbers")}</h3>
    <p>${_("%s has:") % c.page_instance.label}</p>
    <ul>
        <li>${_("<b>%s</b> community members") % c.stats.get('members')|n}</li>
        <li>${_("<b>%s</b> proposals") % c.stats.get('proposals')|n}</li>
        <li>${_("<b>%s</b> comments") % c.stats.get('comments')|n}</li>
    </ul>
</div>

<%components:tutorial>
        <ol id="joyRideTipContent">
          <li data-id="new_proposals_table"
              data-tip-location="top left">
            <p>${_('tutorial_instance_proposals_table')|n}</p>
          </li>
          <li data-id="proposal-actions"
              data-tip-location="top left">
            <p>${_('tutorial_instance_proposal_button')|n}</p>
          </li>
          <li data-id="numbers"
              data-tip-location="top left"
              data-next="${_('Close')}">
            <p>${_('tutorial_instance_numbers')}</p>
          </li>
        </ol>
</%components:tutorial>

</%block>

<%block name="sidebar">

%if h.asbool(config.get('adhocracy.proposal_geotags')):
    <%doc>FIXME: use English translation base string when merging into default
    <h3>${_('Newest geotagged proposals')}</h3>
    </%doc>
    <h3>${_(u'Neueste Vorschl√§ge mit Geotag')}</h3>
    <%doc>filter if p is not None in list comprehension is just a workaround, as SolrPager seems to return None proposals accidently</%doc>
    ${map.show_region_map([p.id for p in c.new_proposals_pager.items if p is not None and p.geotag is not None])}
%endif

</%block>
