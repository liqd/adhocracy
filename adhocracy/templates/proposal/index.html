<%inherit file="/template.html" />
<%namespace name="components" file="/components.html"/>
<%namespace name="map" file="/geo/map.html"/>
<%def name="title()">${_("Proposals")}</%def>

<%def name="breadcrumbs()">
    ${h.proposal.breadcrumbs(None)|n}
</%def>


<%block name="headline">

</%block>

<%block name="main_content">
<h2>${_("Proposals")}</h2>
<div class="hr"><hr /></div>
<div class="list_filter" id="proposals-search">
<form class="list_form" action="?" method="GET" autocomplete="off">
    <label class="floating" for="proposals_q">${_("Find proposals")}</label>
    <input class="q" 
           id="proposals_q" class="live_search" name="proposals_q" 
           type="text" value="${request.params.get('proposals_q', '')}" 
           tabindex="1" />
    <input type="submit" value="${_('Go')}" 
           class="go" />

</form>
</div>
    <div id="proposals_table" class="table">
        ${c.proposals_pager.render_pager()}
    </div>
    <br/>
    <div class="top_actions aside" id="new-proposal">
        <% auth = check.proposal.create() %>
        %if auth:
            <a class="button add ttip" title="${_('Introduce a new idea to debate.')}" href="/proposal/new">${_("new proposal")}</a>
        %elif auth.propose_join():
            <a class="button add ttip" title="${_('Join instance to create a new proposal.')}" href="/proposal/new" rel="#overlay-join-button">${_("new proposal")}</a>
        %elif auth.propose_login():
            <a class="button add ttip" title="${_('Login to create a new proposal.')}" href="/proposal/new" rel="#overlay-login-button">${_("new proposal")}</a>
        %endif

    </div>


<%components:tutorial>
<ol id="joyRideTipContent">

    <li data-id="proposals_table"
        data-tip-location="top left" class="custom">
        ${_('tutorial_proposal_overview_table')}
    </li>

    <li data-id="proposals-search"
        data-tip-location="top right" class="custom">
        <p>${_('tutorial_proposal_overview_facets')}</p>
    </li>

    <li data-id="new-proposal" data-next="${_('Close')}"
        data-tip-location="top-left" class="custom">
        <p>${_('tutorial_proposal_overview_new')}</p>
    </li>
</ol>
</%components:tutorial>

</%block>

<%block name="sidebar">

%if h.asbool(config.get('adhocracy.proposal_geotags')):
    <h3>${_('Map')}</h3>
    <%doc>filter if p is not None in list comprehension is just a workaround, as SolrPager seems to return None proposals accidently</%doc>
    ${map.show_region_map([p.id for p in c.proposals_pager.items if p is not None and p.geotag is not None])}
%endif

    <div id="proposals_facets">
        ${c.proposals_pager.render_facets()}    
    </div>
</%block>
